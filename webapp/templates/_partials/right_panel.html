{#
    Unified right panel content renderer.
    Context variables:
        - item: full execution tree node dict (if available)
        - content: fallback plain content string (legacy)
    Behavior:
        - If node id ends with _messages or _report (leaf content nodes) -> render markdown content.
        - Else (phase / agent level) -> render status summary & child statuses.
#}
{% set node = item if item is defined else None %}
{% set is_leaf_content = node and (node.id.endswith('_messages') or node.id.endswith('_report')) %}
<div class="right-panel-inner">
    {% if node %}
        {% if is_leaf_content %}
            <h3>{{ node.name }}</h3>
            <div class="markdown-body">{{ (node.content or 'No content available.') | markdown | safe }}</div>
        {% else %}
            <h3>{{ node.name }} <small style="font-weight:normal;opacity:0.6;">Status</small></h3>
            <div class="status-summary">
                <p><strong>Status:</strong> {{ node.status }}</p>
                {% if node.started_at %}<p><strong>Started:</strong> {{ node.started_at }}</p>{% endif %}
                {% if node.ended_at %}<p><strong>Ended:</strong> {{ node.ended_at }}</p>{% endif %}
                {% if node.duration_ms %}<p><strong>Duration:</strong> {{ '%.2f' % (node.duration_ms / 1000.0) }}s</p>{% endif %}
                {% if node.children %}
                    <div class="child-statuses">
                        <h4 style="margin-bottom:4px;">Children</h4>
                        <ul class="child-status-list">
                            {% for ch in node.children %}
                                <li class="status-{{ ch.status }}">{{ ch.name }} â€” {{ ch.status }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    {% else %}
        <h3>Content Details</h3>
        <div class="markdown-body">{{ (content or 'Select an item to view details.') | markdown | safe }}</div>
    {% endif %}
</div>